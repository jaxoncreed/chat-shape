"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.mergeDatasetChanges = void 0;
function mergeDatasetChanges(originalChange, newChange) {
    if (newChange.added) {
        if (originalChange.added) {
            originalChange.added.addAll(newChange.added);
        }
        else {
            originalChange.added = newChange.added;
        }
        const changesIntersection = originalChange.removed?.intersection(newChange.added);
        if (changesIntersection && changesIntersection.size > 0) {
            originalChange.removed =
                originalChange.removed?.difference(changesIntersection);
        }
    }
    if (newChange.removed) {
        if (originalChange.removed) {
            originalChange.removed.addAll(newChange.removed);
        }
        else {
            originalChange.removed = newChange.removed;
        }
        const changesIntersection = originalChange.added?.intersection(newChange.removed);
        if (changesIntersection && changesIntersection.size > 0) {
            originalChange.added =
                originalChange.added?.difference(changesIntersection);
        }
    }
    if (originalChange.added && originalChange.added.size === 0) {
        originalChange.added = undefined;
    }
    if (originalChange.removed && originalChange.removed.size === 0) {
        originalChange.removed = undefined;
    }
}
exports.mergeDatasetChanges = mergeDatasetChanges;
//# sourceMappingURL=mergeDatasetChanges.js.map