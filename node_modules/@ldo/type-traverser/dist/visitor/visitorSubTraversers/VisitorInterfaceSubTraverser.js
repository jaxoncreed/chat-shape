"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.visitorInterfaceSubTraverser = void 0;
const VisitorParentSubTraverser_1 = require("./VisitorParentSubTraverser");
async function visitorInterfaceSubTraverser(item, itemTypeName, globals) {
    const { traverserDefinition, visitors } = globals;
    const definition = traverserDefinition[itemTypeName];
    const visitor = visitors[itemTypeName];
    await Promise.all([
        visitor.visitor(item, globals.instanceGraph.getNodeFor(item, itemTypeName), globals.context),
        Promise.all(Object.entries(definition.properties).map(async ([propertyName]) => {
            const originalObject = item[propertyName];
            const originalPropertyDefinition = definition.properties[propertyName];
            const propertyVisitorPromise = visitor.properties[propertyName](originalObject, globals.instanceGraph.getNodeFor(item, itemTypeName), globals.context);
            let propertyTraverserPromise;
            if (originalObject === undefined) {
                propertyTraverserPromise = Promise.resolve();
            }
            else if (Array.isArray(originalObject)) {
                propertyTraverserPromise = Promise.all(originalObject.map(async (subObject) => {
                    await (0, VisitorParentSubTraverser_1.visitorParentSubTraverser)(subObject, originalPropertyDefinition, globals);
                }));
            }
            else {
                propertyTraverserPromise = (0, VisitorParentSubTraverser_1.visitorParentSubTraverser)(originalObject, originalPropertyDefinition, globals);
            }
            return Promise.all([propertyVisitorPromise, propertyTraverserPromise]);
        })),
    ]);
}
exports.visitorInterfaceSubTraverser = visitorInterfaceSubTraverser;
//# sourceMappingURL=VisitorInterfaceSubTraverser.js.map