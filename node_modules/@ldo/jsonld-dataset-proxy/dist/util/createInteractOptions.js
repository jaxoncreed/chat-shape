"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createInteractOptions = void 0;
const isSubjectProxy_1 = require("../subjectProxy/isSubjectProxy");
const types_1 = require("../types");
const isProxy_1 = require("./isProxy");
function createInteractOptions(paramKey, parameter) {
    return {
        using(...objects) {
            const onEndFunctions = [];
            objects.forEach((object) => {
                const proxy = (0, isProxy_1.getProxyFromObject)(object);
                const oldProxyContext = proxy[types_1._proxyContext];
                proxy[types_1._proxyContext] = proxy[types_1._proxyContext].duplicate({
                    [paramKey]: parameter,
                });
                onEndFunctions.push(() => {
                    proxy[types_1._proxyContext] = oldProxyContext;
                });
            });
            return function endWrite() {
                onEndFunctions.forEach((func) => func());
            };
        },
        usingCopy(...objects) {
            return objects.map((object) => {
                const proxy = (0, isSubjectProxy_1.getSubjectProxyFromObject)(object);
                const newProxyContext = proxy[types_1._proxyContext].duplicate({
                    [paramKey]: parameter,
                });
                return newProxyContext.createSubjectProxy(proxy[types_1._getUnderlyingNode]);
            });
        },
    };
}
exports.createInteractOptions = createInteractOptions;
//# sourceMappingURL=createInteractOptions.js.map